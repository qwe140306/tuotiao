{"version":3,"sources":["webpack:///./src/views/login/index.vue?4a05","webpack:///src/views/login/index.vue","webpack:///./src/views/login/index.vue?5b56","webpack:///./src/views/login/index.vue","webpack:///./src/views/login/index.vue?7e03"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","$router","back","ref","onFailed","onLogin","formRules","mobile","model","value","user","callback","$$v","$set","expression","code","scopedSlots","_u","key","fn","isCountDownsh","isSendSmsLoading","preventDefault","onSendSms","apply","arguments","_v","proxy","staticRenderFns","name","components","props","data","computed","watch","methods","err","errors","$toast","message","position","created","mounted","component"],"mappings":"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","file":"js/chunk-1e8f8ab6.846b59da.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login-container\"},[_c('van-nav-bar',{staticClass:\"app-nav-bar\",attrs:{\"left-arrow\":\"\",\"title\":\"登录/注册\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('van-form',{ref:\"loginForm\",attrs:{\"show-error\":false,\"show-error-message\":false,\"validate-first\":\"\"},on:{\"failed\":_vm.onFailed,\"submit\":_vm.onLogin}},[_c('van-field',{attrs:{\"rules\":_vm.formRules.mobile,\"icon-prefix\":\"iconfont icon\",\"left-icon\":\"shouji\",\"name\":\"mobile\",\"placeholder\":\"请输入手机号码\"},model:{value:(_vm.user.mobile),callback:function ($$v) {_vm.$set(_vm.user, \"mobile\", $$v)},expression:\"user.mobile\"}}),_c('van-field',{attrs:{\"rules\":_vm.formRules.code,\"clearable\":\"\",\"icon-prefix\":\"iconfont icon\",\"left-icon\":\"yanzhengma\",\"placeholder\":\"请输入验证码\"},scopedSlots:_vm._u([{key:\"button\",fn:function(){return [(_vm.isCountDownsh)?_c('van-count-down',{attrs:{\"time\":1000 * 60,\"format\":\"ss s\"},on:{\"finish\":function($event){_vm.isCountDownsh = false}}}):_c('van-button',{staticClass:\"send-btn\",attrs:{\"block\":\"\",\"round\":\"\",\"size\":\"mini\",\"loading\":_vm.isSendSmsLoading},on:{\"click\":function($event){$event.preventDefault();return _vm.onSendSms.apply(null, arguments)}}},[_vm._v(\"获取验证码 \")])]},proxy:true}]),model:{value:(_vm.user.code),callback:function ($$v) {_vm.$set(_vm.user, \"code\", $$v)},expression:\"user.code\"}}),_c('div',{staticClass:\"login-btn-wrap\"},[_c('van-button',{staticClass:\"login-btn\",attrs:{\"block\":\"\",\"type\":\"info\"}},[_vm._v(\"登录\")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"login-container\">\r\n    <!-- 顶部 -->\r\n    <van-nav-bar\r\n      class=\"app-nav-bar\"\r\n      left-arrow\r\n      title=\"登录/注册\"\r\n      @click-left=\"$router.back()\"\r\n    />\r\n    <!-- 登录表单 -->\r\n    <van-form\r\n      ref=\"loginForm\"\r\n      :show-error=\"false\"\r\n      :show-error-message=\"false\"\r\n      validate-first\r\n      @failed=\"onFailed\"\r\n      @submit=\"onLogin\"\r\n    >\r\n      <!--\r\n          vant表单验证\r\n            1.使用 van-form 包裹所有要验证的 表单项 van-field\r\n            2. van-form 绑定 onsubmit 事件\r\n              只有表单验证通过才会触发 submit\r\n       -->\r\n      <van-field\r\n        v-model=\"user.mobile\"\r\n        :rules=\"formRules.mobile\"\r\n        icon-prefix=\"iconfont icon\"\r\n        left-icon=\"shouji\"\r\n        name=\"mobile\"\r\n        placeholder=\"请输入手机号码\"\r\n      />\r\n      <van-field\r\n        v-model=\"user.code\"\r\n        :rules=\"formRules.code\"\r\n        clearable\r\n        icon-prefix=\"iconfont icon\"\r\n        left-icon=\"yanzhengma\"\r\n        placeholder=\"请输入验证码\"\r\n      >\r\n        <template #button>\r\n          <van-count-down\r\n            :time=\"1000 * 60\"\r\n            format=\"ss s\"\r\n            v-if=\"isCountDownsh\"\r\n            @finish=\"isCountDownsh = false\"\r\n          />\r\n          <van-button\r\n            block\r\n            class=\"send-btn\"\r\n            round\r\n            size=\"mini\"\r\n            @click.prevent=\"onSendSms\"\r\n            v-else\r\n            :loading=\"isSendSmsLoading\"\r\n            >获取验证码\r\n          </van-button>\r\n        </template>\r\n      </van-field>\r\n      <div class=\"login-btn-wrap\">\r\n        <van-button block class=\"login-btn\" type=\"info\">登录</van-button>\r\n      </div>\r\n    </van-form>\r\n    <!--登录按钮 -->\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\n\r\nexport default {\r\n  name: \"Login\",\r\n  components: {},\r\n  props: {},\r\n  data() {\r\n    return {\r\n      user: {\r\n        mobile: \"13911111111\", //手机号\r\n        code: \"246810\" // 验证码\r\n      },\r\n      // 规则\r\n      formRules: {\r\n        mobile: [\r\n          {\r\n            required: true,\r\n            message: \"请输入手机号\"\r\n          },\r\n          {\r\n            pattern: /^1[3|56789]\\d{9}$/,\r\n            message: \"手机号格式错误\"\r\n          }\r\n        ],\r\n        code: [\r\n          {\r\n            required: true,\r\n            message: \"请输入验证码\"\r\n          },\r\n          {\r\n            pattern: /^\\d{6}$/,\r\n            message: \"验证码格式错误\"\r\n          }\r\n        ]\r\n      },\r\n      // 控制倒计时和发送按钮的显示\r\n      isCountDownsh: false,\r\n      // 点击发送验证码按钮出现loading 加载中 并禁止点击\r\n      isSendSmsLoading: false\r\n    };\r\n  },\r\n  computed: {},\r\n  watch: {},\r\n  methods: {\r\n    // 登录函数\r\n    async onLogin() {\r\n      this.$toast.loading({\r\n        message: \"登陆中\",\r\n        // 禁止点击\r\n        forbidClick: true,\r\n        // 持续时间 ms  值为 0  这个不会消失 直到一个新的提示出现\r\n        duration: 0\r\n      });\r\n      try {\r\n        const { data } = await axios.post(\r\n          \"/app/v1_0/authorizations\",\r\n          this.user\r\n        );\r\n        console.log(data);\r\n        this.$toast.success(\"登录成功\");\r\n        // 将后端返回的 token 放入 Vuex 容器中\r\n        this.$store.commit(\"setUser\", data.data);\r\n        // 清除 layout 的缓存\r\n        this.$store.commit(\"removeCachePages\", 'Layout');\r\n        // 登录成功 跳转回原来页面\r\n        // this.$router.back()\r\n        // 如果有 this.$route.query.redirect 就向后跳转  如果没有直接跳转首页\r\n        this.$router.replace(this.$route.query.redirect || '/')\r\n\r\n\r\n      } catch (err) {\r\n        console.log(err);\r\n        this.$toast.fail(\"登录失败,请稍后重试\");\r\n\r\n      }\r\n    },\r\n    // 表单验证提示函数\r\n    onFailed(err) {\r\n      if (err.errors[0]) {\r\n        this.$toast({\r\n          message: err.errors[0].message,\r\n          position: \"top\"\r\n        });\r\n      }\r\n    },\r\n    // 请求验证码\r\n    async onSendSms() {\r\n      // 点击按钮 展示加载中 防止多次点击 多次发送行为\r\n      this.isSendSmsLoading = true;\r\n      // 校验手机号 发送验证码\r\n      try {\r\n        await this.$refs.loginForm.validate(\"mobile\");\r\n        // 验证通过\r\n        // 隐藏按钮 发送验证码\r\n        this.isCountDownsh = true;\r\n\r\n        await this.$axios.get(`/app/v1_0/sms/codes/${this.user.mobile}`);\r\n      } catch (err) {\r\n        // 验证失败 提示用户\r\n        let message;\r\n        if (err && err.response && err.response.status === 429) {\r\n          message = \"验证码发送频繁，请稍后重试！\";\r\n        } else if (err.name === \"mobile\") {\r\n          message = err.message;\r\n        } else {\r\n          message = \"发送失败，请稍后重试！\";\r\n        }\r\n        // 提示用户\r\n        this.$toast({\r\n          message,\r\n          position: \"top\"\r\n        });\r\n      }\r\n      // 无论发送成功还是失败 关闭加载中状态\r\n      this.isSendSmsLoading = false;\r\n    }\r\n  },\r\n  created() {},\r\n  mounted() {}\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.van-form {\r\n  margin-top: 15px;\r\n}\r\n\r\n// 获取验证码按钮\r\n.send-btn {\r\n  width: 76px;\r\n  height: 23px;\r\n  background-color: #ededed;\r\n\r\n  .van-button__text {\r\n    font-size: 11px;\r\n    color: #666;\r\n  }\r\n}\r\n\r\n// 登录按钮\r\n.login-btn-wrap {\r\n  padding: 26px 16px;\r\n\r\n  .login-btn {\r\n    background-color: #6db4fb;\r\n    border: none;\r\n    border-radius: 5px;\r\n\r\n    .van-button__text {\r\n      font-size: 15px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=55e0a848&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=55e0a848&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"55e0a848\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=55e0a848&lang=less&scoped=true&\""],"sourceRoot":""}